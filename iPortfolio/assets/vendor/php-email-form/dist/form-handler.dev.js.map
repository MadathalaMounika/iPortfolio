{"version":3,"sources":["form-handler.js"],"names":["document","addEventListener","forms","querySelectorAll","forEach","e","event","preventDefault","thisForm","action","getAttribute","recaptcha","displayError","querySelector","classList","add","remove","formData","FormData","grecaptcha","ready","execute","then","token","set","php_email_form_submit","error","fetch","method","body","headers","response","ok","json","Error","status","statusText","url","data","success","reset","innerHTML","message"],"mappings":";;AAAAA,QAAQ,CAACC,gBAAT,CAA0B,kBAA1B,EAA8C,YAAY;AACtD;;AAEA,MAAIC,KAAK,GAAGF,QAAQ,CAACG,gBAAT,CAA0B,iBAA1B,CAAZ;AAEAD,EAAAA,KAAK,CAACE,OAAN,CAAc,UAAUC,CAAV,EAAa;AACvBA,IAAAA,CAAC,CAACJ,gBAAF,CAAmB,QAAnB,EAA6B,UAAUK,KAAV,EAAiB;AAC1CA,MAAAA,KAAK,CAACC,cAAN;AAEA,UAAIC,QAAQ,GAAG,IAAf;AAEA,UAAIC,MAAM,GAAGD,QAAQ,CAACE,YAAT,CAAsB,QAAtB,CAAb;AACA,UAAIC,SAAS,GAAGH,QAAQ,CAACE,YAAT,CAAsB,yBAAtB,CAAhB;;AAEA,UAAI,CAACD,MAAL,EAAa;AACTG,QAAAA,YAAY,CAACJ,QAAD,EAAW,sCAAX,CAAZ;AACA;AACH;;AACDA,MAAAA,QAAQ,CAACK,aAAT,CAAuB,UAAvB,EAAmCC,SAAnC,CAA6CC,GAA7C,CAAiD,SAAjD;AACAP,MAAAA,QAAQ,CAACK,aAAT,CAAuB,gBAAvB,EAAyCC,SAAzC,CAAmDE,MAAnD,CAA0D,SAA1D;AACAR,MAAAA,QAAQ,CAACK,aAAT,CAAuB,eAAvB,EAAwCC,SAAxC,CAAkDE,MAAlD,CAAyD,SAAzD;AAEA,UAAIC,QAAQ,GAAG,IAAIC,QAAJ,CAAaV,QAAb,CAAf;;AAEA,UAAIG,SAAJ,EAAe;AACX,YAAI,OAAOQ,UAAP,KAAsB,WAA1B,EAAuC;AACnCA,UAAAA,UAAU,CAACC,KAAX,CAAiB,YAAY;AACzB,gBAAI;AACAD,cAAAA,UAAU,CAACE,OAAX,CAAmBV,SAAnB,EAA8B;AAAEF,gBAAAA,MAAM,EAAE;AAAV,eAA9B,EACKa,IADL,CACU,UAAAC,KAAK,EAAI;AACXN,gBAAAA,QAAQ,CAACO,GAAT,CAAa,oBAAb,EAAmCD,KAAnC;AACAE,gBAAAA,qBAAqB,CAACjB,QAAD,EAAWC,MAAX,EAAmBQ,QAAnB,CAArB;AACH,eAJL;AAKH,aAND,CAME,OAAOS,KAAP,EAAc;AACZd,cAAAA,YAAY,CAACJ,QAAD,EAAWkB,KAAX,CAAZ;AACH;AACJ,WAVD;AAWH,SAZD,MAYO;AACHd,UAAAA,YAAY,CAACJ,QAAD,EAAW,iDAAX,CAAZ;AACH;AACJ,OAhBD,MAgBO;AACHiB,QAAAA,qBAAqB,CAACjB,QAAD,EAAWC,MAAX,EAAmBQ,QAAnB,CAArB;AACH;AACJ,KArCD;AAsCH,GAvCD;;AAyCA,WAASQ,qBAAT,CAA+BjB,QAA/B,EAAyCC,MAAzC,EAAiDQ,QAAjD,EAA2D;AACvDU,IAAAA,KAAK,CAAClB,MAAD,EAAS;AACVmB,MAAAA,MAAM,EAAE,MADE;AAEVC,MAAAA,IAAI,EAAEZ,QAFI;AAGVa,MAAAA,OAAO,EAAE;AAAE,4BAAoB;AAAtB;AAHC,KAAT,CAAL,CAKKR,IALL,CAKU,UAAAS,QAAQ,EAAI;AACd,UAAIA,QAAQ,CAACC,EAAb,EAAiB;AACb,eAAOD,QAAQ,CAACE,IAAT,EAAP;AACH,OAFD,MAEO;AACH,cAAM,IAAIC,KAAJ,WAAaH,QAAQ,CAACI,MAAtB,cAAgCJ,QAAQ,CAACK,UAAzC,cAAuDL,QAAQ,CAACM,GAAhE,EAAN;AACH;AACJ,KAXL,EAYKf,IAZL,CAYU,UAAAgB,IAAI,EAAI;AACV9B,MAAAA,QAAQ,CAACK,aAAT,CAAuB,UAAvB,EAAmCC,SAAnC,CAA6CE,MAA7C,CAAoD,SAApD;;AACA,UAAIsB,IAAI,CAACC,OAAT,EAAkB;AACd/B,QAAAA,QAAQ,CAACK,aAAT,CAAuB,eAAvB,EAAwCC,SAAxC,CAAkDC,GAAlD,CAAsD,SAAtD;AACAP,QAAAA,QAAQ,CAACgC,KAAT;AACH,OAHD,MAGO;AACH,cAAM,IAAIN,KAAJ,CAAUI,IAAI,CAACZ,KAAL,GAAaY,IAAI,CAACZ,KAAlB,GAA0B,gEAAgEjB,MAApG,CAAN;AACH;AACJ,KApBL,WAqBW,UAACiB,KAAD,EAAW;AACdd,MAAAA,YAAY,CAACJ,QAAD,EAAWkB,KAAX,CAAZ;AACH,KAvBL;AAwBH;;AAED,WAASd,YAAT,CAAsBJ,QAAtB,EAAgCkB,KAAhC,EAAuC;AACnClB,IAAAA,QAAQ,CAACK,aAAT,CAAuB,UAAvB,EAAmCC,SAAnC,CAA6CE,MAA7C,CAAoD,SAApD;AACAR,IAAAA,QAAQ,CAACK,aAAT,CAAuB,gBAAvB,EAAyC4B,SAAzC,GAAqDf,KAAK,CAACgB,OAA3D;AACAlC,IAAAA,QAAQ,CAACK,aAAT,CAAuB,gBAAvB,EAAyCC,SAAzC,CAAmDC,GAAnD,CAAuD,SAAvD;AACH;AAEJ,CA/ED","sourcesContent":["document.addEventListener('DOMContentLoaded', function () {\r\n    \"use strict\";\r\n\r\n    let forms = document.querySelectorAll('.php-email-form');\r\n\r\n    forms.forEach(function (e) {\r\n        e.addEventListener('submit', function (event) {\r\n            event.preventDefault();\r\n\r\n            let thisForm = this;\r\n\r\n            let action = thisForm.getAttribute('action');\r\n            let recaptcha = thisForm.getAttribute('data-recaptcha-site-key');\r\n\r\n            if (!action) {\r\n                displayError(thisForm, 'The form action property is not set!');\r\n                return;\r\n            }\r\n            thisForm.querySelector('.loading').classList.add('d-block');\r\n            thisForm.querySelector('.error-message').classList.remove('d-block');\r\n            thisForm.querySelector('.sent-message').classList.remove('d-block');\r\n\r\n            let formData = new FormData(thisForm);\r\n\r\n            if (recaptcha) {\r\n                if (typeof grecaptcha !== \"undefined\") {\r\n                    grecaptcha.ready(function () {\r\n                        try {\r\n                            grecaptcha.execute(recaptcha, { action: 'php_email_form_submit' })\r\n                                .then(token => {\r\n                                    formData.set('recaptcha-response', token);\r\n                                    php_email_form_submit(thisForm, action, formData);\r\n                                })\r\n                        } catch (error) {\r\n                            displayError(thisForm, error);\r\n                        }\r\n                    });\r\n                } else {\r\n                    displayError(thisForm, 'The reCaptcha javascript API url is not loaded!')\r\n                }\r\n            } else {\r\n                php_email_form_submit(thisForm, action, formData);\r\n            }\r\n        });\r\n    });\r\n\r\n    function php_email_form_submit(thisForm, action, formData) {\r\n        fetch(action, {\r\n            method: 'POST',\r\n            body: formData,\r\n            headers: { 'X-Requested-With': 'XMLHttpRequest' }\r\n        })\r\n            .then(response => {\r\n                if (response.ok) {\r\n                    return response.json();\r\n                } else {\r\n                    throw new Error(`${response.status} ${response.statusText} ${response.url}`);\r\n                }\r\n            })\r\n            .then(data => {\r\n                thisForm.querySelector('.loading').classList.remove('d-block');\r\n                if (data.success) {\r\n                    thisForm.querySelector('.sent-message').classList.add('d-block');\r\n                    thisForm.reset();\r\n                } else {\r\n                    throw new Error(data.error ? data.error : 'Form submission failed and no error message returned from: ' + action);\r\n                }\r\n            })\r\n            .catch((error) => {\r\n                displayError(thisForm, error);\r\n            });\r\n    }\r\n\r\n    function displayError(thisForm, error) {\r\n        thisForm.querySelector('.loading').classList.remove('d-block');\r\n        thisForm.querySelector('.error-message').innerHTML = error.message;\r\n        thisForm.querySelector('.error-message').classList.add('d-block');\r\n    }\r\n\r\n});\r\n"],"file":"form-handler.dev.js"}